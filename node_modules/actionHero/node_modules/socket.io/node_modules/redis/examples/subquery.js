if (process.env.REDISTOGO_URL) {
	var rtg   = require("url").parse(process.env.REDISTOGO_URL);
	var client = require("redis").createClient(rtg.port, rtg.hostname);

	client.auth(rtg.auth.split(":")[1]);

} else {

	var client = require("redis").createClient();
}

function print_results(obj) {
    console.dir(obj);
}

// build a map of all keys and their types
client.keys("*", function (err, all_keys) {
    var key_types = {};
    
    all_keys.forEach(function (key, pos) { // use second arg of forEach to get pos
        client.type(key, function (err, type) {
            key_types[key] = type;
            if (pos === all_keys.length - 1) { // callbacks all run in order
                print_results(key_types);
            }
        });
    });
});
